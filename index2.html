<!doctype html>
<html lang="fr">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Spectrographie(s) v1</title>

    <link rel="stylesheet" href="src/bootstrap-3.3.7\dist\css\bootstrap.css">
    <link href="src/style/navbar-fixed-side.css" rel="stylesheet" />
    <link href="src/modal_sidebar.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-theme/0.1.0-beta.10/select2-bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/MarkerCluster.Default.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="css/leaflet.extra-markers.min.css">
    <link rel="stylesheet" href="css/style.css">




    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="js/leaflet.extra-markers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/leaflet.markercluster-src.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/leaflet.markercluster.js"></script>


    <div class="container-fluid" id="map"> </div>


    <!-- Left Menu -->

    <div id="menu" class="container-fluid">
        <div class="col-sm-6 col-md-6 col-lg-6">
            <nav class="navbar navbar-default navbar-fixed-side" id="navBarLeft">

                <!-- Header -->

                <div class="navbar-header">
                    <a class="navbar-brand" href=""><h3> Navigation </h3></a>
                </div>


                <!-- Select lists -->
                <div class="container-fluid ">
                    <div class="well formContainer">
                        <div class="form-group">
                            <label for="single" class="control-label">Participant</label>
                            <select id="single" class="form-control select2-single">
                                <option></option>
                                <optgroup label="Alaskan/Hawaiian Time Zone">
                                    <option value="AK">Alaska</option>
                                    <option value="HI" disabled="disabled">Hawaii</option>
                            </select>
                        </div>
                    </div>

                    <div class="well formContainer">
                        <div class="form-group">
                            <label for="single" class="control-label">Type</label>
                            <select id="single" class="form-control select2-single">
                                <option></option>
                                <optgroup label="Alaskan/Hawaiian Time Zone">
                                    <option value="AK">Alaska</option>
                                    <option value="HI" disabled="disabled">Hawaii</option>
                            </select>
                        </div>
                    </div>


                    <div class="well formContainer">
                        <div class="form-group">
                            <label for="single" class="control-label">Genre</label>
                            <select id="single" class="form-control select2-single">
                                <option></option>
                                <optgroup label="Alaskan/Hawaiian Time Zone">
                                    <option value="AK">Alaska</option>
                                    <option value="HI" disabled="disabled">Hawaii</option>
                            </select>
                        </div>
                    </div>

                    <div class="well formContainer">
                        <div class="form-group">
                            <label for="single" class="control-label">Média</label>
                            <select id="single" class="form-control select2-single">
                                <option></option>
                                <optgroup label="Alaskan/Hawaiian Time Zone">
                                    <option value="AK">Alaska</option>
                                    <option value="HI" disabled="disabled">Hawaii</option>
                            </select>
                        </div>
                    </div>
                </div>

            </nav>

        </div>

    </div>





    <nav class="navbar navbar-fixed-top">

        <div class="navbar-header" id="navBarTop">

            <div id=toggle-bar>
                <button type="button" id="togglebtn" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>

            <div id='title'>
                <h1>
    Spectrographie(s) du territoire
  </h1>
                <div>



                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            <div class="well">

                                <h4> À propos de Spectrographies</h4>

                                <p>

                                    Où suis-je ?
                                    <br> Chez qui suis-je ?
                                    <br> Que me propose-t-on ?
                                    <br> Sous quelles conditions ?
                                    <br> Qu’est-ce qui pourrait m’amener à revenir ?
                                    <br> L’information est-elle à jour ?
                                    <br> Puis-je contacter les propriétaires du site ?
                                    <br> Suis-je arrivé à tout lire sans m’endormir ?
                                    <br> </p>


                                <h4> Contact </h4>
                                <hr>
                                <p> Natacha Clitandre : <a> + 1 514-555-5555</a>
                                </p>
                                <p> Courriel : <a> abcd@gmail.com </a> </p>
                                <hr>
                                <p> Agence TOPO : <a> + 1 514-555-5555</a>
                                </p>
                                <p> Courriel : <a> abcd@gmail.com </a> </p>

                            </div>
                        </ul>


                        <!--USERNAME  could be used for linking to the Fulcrum Admin Page 

    <div class="navbar-header navbar-right">
      <p class="navbar-text">
      <a href="#" class="navbar-link">Username</a>
      </p>
    </div>

    -->


    </nav>


    <div id="myModal" class="modal">
        <div id="modalContent" class="container-fluid">
            <div class="row modalContainer">
                <span class="close">&times;</span>


                <div id="imgContainer" class=" col-sm-7 col-md-6 col-lg-7 col-xl-7">
                    <!--<img class="img-responsive" id="img01">-->
                    <div id="myCarousel" class="carousel slide" data-ride="carousel">
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                            <li data-target="#myCarousel" data-slide-to="1"></li>
                            <li data-target="#myCarousel" data-slide-to="2"></li>
                        </ol>

                        <!-- Wrapper for slides -->
                        <div id="carousel-inner" class="carousel-inner"></div>

                        <!-- Left and right controls -->
                        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#myCarousel" data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>

                </div>

                <div class=''>

                    <div id="caption" class=" well col-sm-5 col-md-6 col-lg-5 col-xl-5"></div>

                </div>

            </div>
        </div>
    </div>


<script>

$(function() {



var map = L.map('map', {
          zoomControl: true}).setView([45.5314, -73.6750], 9);



var baseLayer1 = L.tileLayer('https://api.mapbox.com/styles/v1/clementg123/cj66rikp37hgc2rltvyo7eepa/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY2xlbWVudGcxMjMiLCJhIjoiY2o2M3ZhODh3MWxwNDJxbnJnaGZxcWNoMiJ9.YroDniTcealGFJgHtQ2hDg')

var baseLayer2 = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}.{ext}', {
  attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  subdomains: 'abcd',
  minZoom: 0,
  maxZoom: 20,
  ext: 'png'
}).addTo(map);


var markerCluster = L.markerClusterGroup({
  spiderfyOnMaxZoom: true,
  showCoverageOnHover: false,
  zoomToBoundsOnClick: true,
  removeOutsideVisibleBounds: true,
  maxClusterRadius: 50

});

var group = L.layerGroup();
var marker = L.geoJSON();

function getGeoJSON() {
$.when(
 $.getJSON('https://web.fulcrumapp.com/shares/3a4bbd0435c58166.geojson')).done(function(theGeoJSON) {

  (function removeNull(o) {
        for(var key in o) {
            if( null === o[key] ) o[key] = '';
            if ( typeof o[key] === 'object' ) removeNull(o[key]);
        }
     })(theGeoJSON);

markers = theGeoJSON.features;


/////  L.Geojson //////
marker = new L.geoJSON(markers, {

 
   pointToLayer: function(feature, latlng) {

     var customMarker = new L.ExtraMarkers.icon(
     {
          icon: 'glyphicon-eye-open',
          markerColor: 'cyan',
          shape: 'penta',
          prefix: 'glyphicon'
        });

        return L.marker(latlng, {icon:customMarker})       
      },


  onEachFeature: function(feature, layer) {

var baseURL = "https://web.fulcrumapp.com/shares/3a4bbd0435c58166/photos/"
var div1 = '<div class="item active"><img src="'+baseURL+feature.properties.photos_url.substring(70,106)+'" id="img01" ></div>'
var div2 = '<div class="item "><img src="'+baseURL+feature.properties.photos_url.substring(109,145)+'" id="img02" ></div>'
var div3 = '<div class="item "><img src="'+baseURL+feature.properties.photos_url.substring(148,184)+'" id="img03" ></div>'
var div4 = '<div class="item "><img src="'+baseURL+feature.properties.photos_url.substring(187,223)+'" id="img04" ></div>'
var div5 = '<div class="item "><img src="'+baseURL+feature.properties.photos_url.substring(226,262)+'" id="img05" ></div>'


function photoCount(){
        
    if (feature.properties.photos_url.length === 262) {
    return div1+div2+div3+div4+div5
    //return console.log("J'ai 5 photos")
    }

    else if (feature.properties.photos_url.length === 223) {
   // return console.log("J'ai 4 photos")
    return div1+div2+div3+div4
    }

    else if (feature.properties.photos_url.length === 184) {
    //return console.log("J'ai 3 photos")
     return div1+div2+div3
    }

    else if (feature.properties.photos_url.length === 145) {
     //return console.log("J'ai 2 photos")
     return div1+div2
    }

    else if (feature.properties.photos_url.length === 106) {
    //return console.log("J'ai 1 photos")
    return div1
    }};

photoCount()


    
// Capture le pop up //
map.on('popupopen', function () {
                 
      var h2 = document.getElementById('titrePopUp');
      var img = document.getElementById('myImg');
      var modal = document.getElementById('myModal');
      var captionText = document.getElementById("caption");
      var carouselDiv = document.getElementById("carousel-inner")

    // Fonction pour creer le contenu du modal //
          img.onclick = function(){ 
           map.closePopup();
           modal.style.display = "block";
           captionText.innerHTML = img.alt
           carouselDiv.innerHTML = photoCount()


    // Fonction pour fermer le modal //
      var span = document.getElementsByClassName("close")[0];
      span.onclick = function() { 
      modal.style.display = "none";
      }
    }
});

///////// START Bind tout le data dans le pop up /////////

     layer.bindPopup(
     '<div id="popUpOpen"><a href="#" id="titrePopUp"><h2>'

     // Pop Up Content

       +feature.properties.titre
       +'</h2></a><h3 style="display:inline">'
       +feature.properties.genre
       +' & '
       +feature.properties.type
       +'</h3><h4> Par : '
       +feature.properties.pseudo


      // Modal Section Content //


         +'</h4><div id=&quot;attributeContainer&quot;>'
         // Image section
         +'<img class="img-thumbnail "id="myImg"'
         // Alt section with all the data for the modal popup
                 +' alt="<div><h2>'
                 +feature.properties.titre
                 +'</h2><br><h3 style=&quot;display: inline !important;&quot;> Genre : </h3><h4 style=&quot;display: inline !important;&quot;>'
                 +feature.properties.genre
                 +'</h4><br><br><h3 style=&quot;display: inline !important;&quot;> Type : </h3><h4 style=&quot;display: inline !important;&quot;>'
                 +feature.properties.type
                 +'</h4><br><h3> Contexte : </h3><p>'
                 +feature.properties.description_contexte
                 +'</p><div class=&quot;well&quot; style=&quot;margin-top:15px !important&quot;><div class=&quot;col-sm-8 well &quot; ><h3 style=&quot;display: inline !important;&quot;> Auteur : </h3><h4 style=&quot;display: inline !important;&quot;>'
                 +feature.properties.pseudo
                  // Autoportrait //
                 +'</h4></div><div class=&quot;col-sm-4 well&quot;><img  id=&quot;selfie&quot; class=&quot;img-thumbnail&quot; src=&quot;'
                 +feature.properties.autoportrait_url.replace('view?photos=','')
                 +'&quot;</img></div><div class=&quot;col well&quot;><h3> Relation au lieu : </h3><p>'
                 +feature.properties.relation_au_lieu_appartenance
                 +'</p></div></div></div>'
                 // Audio //
                 +'<div class=&quot;col  well&quot;>'
                 +'<audio controls controls controlsList=&quot;nodownload&quot;><source src=&quot;'
                 +feature.properties.audio_url.replace('view?audio=','')
                 //+feature.properties.audio_url.replace('view?audio=','')
                 +'&quot;</audio></div></div></div>'
                 // End of alt attribution
                 // Caroussel
         +'" src="'
         //+photosPreURL+first
         +feature.properties.photos_url.substring(0,106).replace('view?photos=','') 
         +'"></div></img>'   
        
    // Socials // 

      //Facbook
     +'<iframe src="https://www.facebook.com/plugins/share_button.php?href='
       + feature.properties.photos_url.replace('view?photos=','')
       +'&layout=button&size=small&mobile_iframe=false&width=59&height=20&appId" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>'

       +'  '
      //Twitter 
       +'<iframe id="tweet-button" allowtransparency="true" frameborder="0" scrolling="no"  src="http://platform.twitter.com/widgets/tweet_button.html?url='
       +feature.properties.photos_url.replace('view?photos=','')+
       '&amp;count=horizontal"   style="width:110px; height:20px;"></iframe>')

    
    } ///////// END Bind tout le data dans le pop up /////////



});  //end _filtermarker

//return _filteredMarker.addTo(map)
markerCluster.addLayer(marker)
group.addLayer(marker)
map.addLayer(markerCluster)  
map.fitBounds(marker.getBounds())

   });
}

// Click outside the header info div collapse //

$(document).click(function(e) {
    if (!$(e.target).is('a')) {
        $('.collapse').collapse('hide');        
    }
});


getGeoJSON()

})
  </script>  
</head>
</body>
</html>

